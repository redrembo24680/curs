<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ—ñ–ª—å ¬∑ –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <div class="logo">‚öΩ –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</div>
        <ul class="nav-links">
            <li><a href="/">–ì–æ–ª–æ–≤–Ω–∞</a></li>
            <li><a href="/players">–ì—Ä–∞–≤—Ü—ñ</a></li>
            <li><a href="/matches">–ú–∞—Ç—á—ñ</a></li>
            <li><a href="/stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
            <li><a href="/posts">–ù–æ–≤–∏–Ω–∏</a></li>
            <li><a href="/profile" class="active">–ü—Ä–æ—Ñ—ñ–ª—å</a></li>
            <li><a href="/health">–°—Ç–∞–Ω API</a></li>
        </ul>
        <div class="nav-meta">
            <div class="stats-bar" id="stats-bar">
                <span>üë• 0 –≥—Ä–∞–≤—Ü—ñ–≤</span>
                <span>üèüÔ∏è 0 –º–∞—Ç—á—ñ–≤</span>
                <span>üó≥Ô∏è 0 –≥–æ–ª–æ—Å—ñ–≤</span>
            </div>
            <div class="auth-bar" id="auth-bar">
                <a class="btn ghost" href="/login">–£–≤—ñ–π—Ç–∏</a>
                <a class="btn primary small" href="/register">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            </div>
        </div>
    </nav>

    <main>
        <div id="flash-container"></div>

        <section class="section">
            <div class="card">
                <h2>–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h2>
                <div id="user-info" style="margin-bottom: 2rem;">
                    <p class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="card">
                <h2>–Ü—Å—Ç–æ—Ä—ñ—è –≥–æ–ª–æ—Å—É–≤–∞–Ω—å</h2>
                <div id="votes-history" style="margin-top: 1rem;">
                    <p class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞ –≥—Ä–∞–≤—Ü—ñ–≤ &middot; Backend: C++ ¬∑ Frontend: Static HTML
    </footer>

    <script src="/static/app.js"></script>
    <script>
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user-info', {
                    credentials: 'same-origin'
                });
                const userInfo = await response.json();

                const userInfoDiv = document.getElementById('user-info');
                if (userInfo.logged_in) {
                    userInfoDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="width: 60px; height: 60px; border-radius: 50%; background: #3b82f6; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">
                        ${(userInfo.username || 'U')[0].toUpperCase()}
                    </div>
                    <div>
                        <h3 style="margin: 0;">${userInfo.username || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'}</h3>
                        <p style="margin: 0.25rem 0 0 0; color: #6b7280;">
                            ${userInfo.role === 'admin' ? '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' : '–í–±–æ–ª—ñ–≤–∞–ª—å–Ω–∏–∫'}
                        </p>
                    </div>
                </div>
            `;
                } else {
                    userInfoDiv.innerHTML = '<p class="muted">–ü–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–π—Ç–∏ –¥–æ —Å–∏—Å—Ç–µ–º–∏</p>';
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        async function loadVotesHistory() {
            try {
                const response = await fetch('/api/profile/votes', {
                    credentials: 'same-origin'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const votes = data.votes || [];
                const votesDiv = document.getElementById('votes-history');

                if (votes.length === 0) {
                    votesDiv.innerHTML = '<p class="muted">–í–∏ —â–µ –Ω–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏ –≤ –∂–æ–¥–Ω–æ–º—É –º–∞—Ç—á—ñ.</p>';
                    return;
                }

                votesDiv.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ú–∞—Ç—á</th>
                        <th>–ì—Ä–∞–≤–µ—Ü—å</th>
                        <th>–ü–æ–∑–∏—Ü—ñ—è</th>
                    </tr>
                </thead>
                <tbody>
                    ${votes.map(vote => `
                        <tr>
                            <td>${new Date(vote.created_at).toLocaleString('uk-UA')}</td>
                            <td><strong>${vote.match.team1 || '–ö–æ–º–∞–Ω–¥–∞ 1'}</strong> vs <strong>${vote.match.team2 || '–ö–æ–º–∞–Ω–¥–∞ 2'}</strong></td>
                            <td>${vote.player.name || '–ù–µ–≤—ñ–¥–æ–º–æ'}</td>
                            <td>${vote.player.position || '-'}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
            } catch (error) {
                console.error('Error loading votes history:', error);
                document.getElementById('votes-history').innerHTML = '<p class="muted">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –≥–æ–ª–æ—Å—É–≤–∞–Ω—å.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadGlobalStats();
            loadUserInfo();
            loadVotesHistory();

            // Update auth bar
            const authBar = document.getElementById('auth-bar');
            if (authBar) {
                fetch('/api/user-info', { credentials: 'same-origin' })
                    .then(r => r.json())
                    .then(userInfo => {
                        if (userInfo.logged_in) {
                            authBar.innerHTML = `
                        <span class="user-pill" style="margin-right: 0.5rem; padding: 0.5rem 1rem; background: #f3f4f6; border-radius: 20px; font-size: 0.9rem;">
                            ${userInfo.username || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'}
                            ${userInfo.role === 'admin' ? '<small style="margin-left: 0.5rem; padding: 0.2rem 0.5rem; background: #10b981; color: white; border-radius: 10px; font-size: 0.75rem;">Admin</small>' : ''}
                        </span>
                        <a class="btn ghost" href="/logout">–í–∏–π—Ç–∏</a>
                    `;
                        } else {
                            window.location.href = '/login';
                        }
                    });
            }
        });
    </script>
</body>

</html>