<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ¬∑ –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/stats.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
<nav class="navbar">
    <div class="logo">‚öΩ –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</div>
    <ul class="nav-links">
        <li><a href="/">–ì–æ–ª–æ–≤–Ω–∞</a></li>
        <li><a href="/players">–ì—Ä–∞–≤—Ü—ñ</a></li>
        <li><a href="/matches">–ú–∞—Ç—á—ñ</a></li>
        <li><a href="/stats" class="active">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
        <li><a href="/posts">–ù–æ–≤–∏–Ω–∏</a></li>
        <li><a href="/profile">–ü—Ä–æ—Ñ—ñ–ª—å</a></li>
        <li><a href="/health">–°—Ç–∞–Ω API</a></li>
    </ul>
    <div class="nav-meta">
        <div class="stats-bar" id="stats-bar">
            <span>üë• 0 –≥—Ä–∞–≤—Ü—ñ–≤</span>
            <span>üèüÔ∏è 0 –º–∞—Ç—á—ñ–≤</span>
            <span>üó≥Ô∏è 0 –≥–æ–ª–æ—Å—ñ–≤</span>
        </div>
        <div class="auth-bar" id="auth-bar">
            <a class="btn ghost" href="/login">–£–≤—ñ–π—Ç–∏</a>
            <a class="btn primary small" href="/register">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
        </div>
    </div>
</nav>

<main>
    <div id="flash-container"></div>

    <section class="section intro">
        <div>
            <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏</h1>
            <p class="muted">–î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤ —Ç–∞ –º–∞—Ç—á—ñ–≤</p>
        </div>
    </section>

    <section class="section grid-two">
        <div class="card">
            <h2>üèÜ –¢–æ–ø-10 –≥—Ä–∞–≤—Ü—ñ–≤</h2>
            <div id="top-players" class="top-players-list">
                <p class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>
        </div>

        <div class="card">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç—á—ñ–≤</h2>
            <div style="margin-bottom: 1.5rem;">
                <label for="match-select" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–û–±–µ—Ä—ñ—Ç—å –º–∞—Ç—á:</label>
                <select id="match-select" style="width: 100%; padding: 0.75rem;">
                    <option value="">-- –í—Å—ñ –º–∞—Ç—á—ñ --</option>
                </select>
            </div>
            <div id="match-stats">
                <p class="muted">–û–±–µ—Ä—ñ—Ç—å –º–∞—Ç—á –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
            </div>
        </div>
    </section>
</main>

<footer>
    –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞ –≥—Ä–∞–≤—Ü—ñ–≤ &middot; Backend: C++ ¬∑ Frontend: Static HTML
</footer>

<script src="/static/app.js"></script>
<script>
async function loadStats() {
    try {
        console.log('Loading stats...');
        const data = await api.get('/stats-page', { matches: [], top_players: [] });
        console.log('Stats data received:', data);
        
        const topPlayers = data.top_players || [];
        const matches = data.matches || [];
        
        console.log('Top players:', topPlayers.length);
        console.log('Matches:', matches.length);
        
        // Render top players
        const topPlayersDiv = document.getElementById('top-players');
        if (!topPlayersDiv) {
            console.error('top-players element not found');
            return;
        }
        
        if (topPlayers.length === 0) {
            topPlayersDiv.innerHTML = '<p class="muted">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ —Ä–µ–π—Ç–∏–Ω–≥—É.</p>';
        } else {
            topPlayersDiv.innerHTML = topPlayers.slice(0, 10).map((player, index) => `
                <div class="player-stat-item ${index < 3 ? 'top-three' : ''}">
                    <div class="player-rank">
                        <span class="rank-number">${index + 1}</span>
                        ${index === 0 ? '<span class="rank-icon">ü•á</span>' : ''}
                        ${index === 1 ? '<span class="rank-icon">ü•à</span>' : ''}
                        ${index === 2 ? '<span class="rank-icon">ü•â</span>' : ''}
                    </div>
                    <div class="player-info-stat">
                        <div class="player-name-stat">${player.name || '–ù–µ–≤—ñ–¥–æ–º–∏–π –≥—Ä–∞–≤–µ—Ü—å'}</div>
                        <div class="player-position-stat">${player.position || ''}</div>
                    </div>
                    <div class="player-votes-stat">
                        <span class="votes-count">${player.votes || 0}</span>
                        <span class="votes-label">–≥–æ–ª–æ—Å—ñ–≤</span>
                    </div>
                </div>
            `).join('');
        }
        
        // Render matches select
        const select = document.getElementById('match-select');
        if (!select) {
            console.error('match-select element not found');
            return;
        }
        
        if (matches.length === 0) {
            select.innerHTML = '<option value="">–ù–µ–º–∞—î –º–∞—Ç—á—ñ–≤</option>';
            const matchStatsDiv = document.getElementById('match-stats');
            if (matchStatsDiv) {
                matchStatsDiv.innerHTML = '<p class="muted">–ù–µ–º–∞—î –º–∞—Ç—á—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.</p>';
            }
        } else {
            select.innerHTML = '<option value="">-- –í—Å—ñ –º–∞—Ç—á—ñ --</option>' +
                matches.map(m => {
                    const matchId = m.match_id || m.id || m.matchId || 0;
                    const team1 = m.team1 || '–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞';
                    const team2 = m.team2 || '–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞';
                    // Only show if both teams have valid names
                    if (team1 && team2 && team1 !== '–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞' && team2 !== '–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞') {
                        return `<option value="${matchId}">${team1} vs ${team2}</option>`;
                    }
                    return null;
                }).filter(opt => opt !== null).join('');
            
            // Remove old event listeners by cloning
            const newSelect = select.cloneNode(true);
            select.parentNode.replaceChild(newSelect, select);
            
            newSelect.addEventListener('change', (e) => {
                const matchId = parseInt(e.target.value);
                if (matchId) {
                    const match = matches.find(m => {
                        const id = m.match_id || m.id || m.matchId || 0;
                        return id == matchId;
                    });
                    if (match) {
                        renderMatchStats(match);
                    } else {
                        const matchStatsDiv = document.getElementById('match-stats');
                        if (matchStatsDiv) {
                            matchStatsDiv.innerHTML = '<p class="muted">–ú–∞—Ç—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>';
                        }
                    }
                } else {
                    const matchStatsDiv = document.getElementById('match-stats');
                    if (matchStatsDiv) {
                        matchStatsDiv.innerHTML = '<p class="muted">–û–±–µ—Ä—ñ—Ç—å –º–∞—Ç—á –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>';
                    }
                }
            });
        }
    } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('top-players').innerHTML = '<p class="muted" style="color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.</p>';
        document.getElementById('match-stats').innerHTML = '<p class="muted" style="color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.</p>';
    }
}

function renderMatchStats(match) {
    const team1 = match.team1 || '';
    const team2 = match.team2 || '';
    // Check for invalid team names
    if (!team1 || !team2 || 
        team1.includes('–ö–æ–º–∞–Ω–¥–∞ 1') || team1.includes('–ö–æ–º–∞–Ω–¥–∞ 2') ||
        team2.includes('–ö–æ–º–∞–Ω–¥–∞ 1') || team2.includes('–ö–æ–º–∞–Ω–¥–∞ 2') ||
        team1.includes('Team 1') || team1.includes('Team 2') ||
        team2.includes('Team 1') || team2.includes('Team 2')) {
        document.getElementById('match-stats').innerHTML = '<p class="muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –∫–æ–º–∞–Ω–¥–∏ –∞–±–æ –∫–æ–º–∞–Ω–¥–∏ –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ.</p>';
        return;
    }
    
    const statsHTML = `
        <div class="match-stats-card">
            <h3>${team1} vs ${team2}</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">–í–æ–ª–æ–¥—ñ–Ω–Ω—è –º'—è—á–µ–º:</span>
                    <span class="stat-value">${match.team1_possession || 0}% - ${match.team2_possession || 0}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–£–¥–∞—Ä–∏:</span>
                    <span class="stat-value">${match.team1_shots || 0} - ${match.team2_shots || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–£–¥–∞—Ä–∏ –≤ —Ä–∞–º–∫—É:</span>
                    <span class="stat-value">${match.team1_shots_on_target || 0} - ${match.team2_shots_on_target || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ö—É—Ç–æ–≤—ñ:</span>
                    <span class="stat-value">${match.team1_corners || 0} - ${match.team2_corners || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ü–æ—Ä—É—à–µ–Ω–Ω—è:</span>
                    <span class="stat-value">${match.team1_fouls || 0} - ${match.team2_fouls || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ñ–æ–≤—Ç—ñ –∫–∞—Ä—Ç–∫–∏:</span>
                    <span class="stat-value">${match.team1_yellow_cards || 0} - ${match.team2_yellow_cards || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ß–µ—Ä–≤–æ–Ω—ñ –∫–∞—Ä—Ç–∫–∏:</span>
                    <span class="stat-value">${match.team1_red_cards || 0} - ${match.team2_red_cards || 0}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ì–æ–ª–∏:</span>
                    <span class="stat-value"><strong>${match.team1_goals || 0} - ${match.team2_goals || 0}</strong></span>
                </div>
            </div>
        </div>
    `;
    const matchStatsDiv = document.getElementById('match-stats');
    if (matchStatsDiv) {
        matchStatsDiv.innerHTML = statsHTML;
    }
}

document.addEventListener('DOMContentLoaded', () => {
    console.log('Stats page loaded');
    loadStats();
});
</script>
</body>
</html>

