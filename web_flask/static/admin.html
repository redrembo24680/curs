<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Адмін-панель - Система голосування</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .match-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .match-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }
        
        .match-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .status-active {
            background: #4CAF50;
            color: white;
        }
        
        .status-inactive {
            background: #9e9e9e;
            color: white;
        }
        
        .stats-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }
        
        .form-group input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2196F3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1976D2;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #388E3C;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <nav class="nav">
        <ul class="nav-list">
            <li><a href="/">Головна</a></li>
            <li><a href="/matches">Матчі</a></li>
            <li><a href="/players">Гравці</a></li>
            <li><a href="/stats">Статистика</a></li>
            <li><a href="/admin" class="active">Адмін</a></li>
            <li><a href="/profile">Профіль</a></li>
        </ul>
    </nav>

    <div class="admin-container">
        <h1>Адмін-панель: Управління матчами</h1>
        
        <div id="alert" class="hidden"></div>
        <div id="matches-container"></div>
    </div>

    <script>
        let matchesData = [];

        async function loadMatches() {
            try {
                const response = await fetch('/api/admin/matches');
                const data = await response.json();
                
                if (response.ok && data.matches) {
                    matchesData = data.matches;
                    renderMatches();
                } else {
                    showAlert('Помилка завантаження матчів', 'error');
                }
            } catch (error) {
                console.error('Error loading matches:', error);
                showAlert('Помилка завантаження даних', 'error');
            }
        }

        function renderMatches() {
            const container = document.getElementById('matches-container');
            container.innerHTML = '';

            matchesData.forEach(match => {
                const card = createMatchCard(match);
                container.appendChild(card);
            });
        }

        function createMatchCard(match) {
            const card = document.createElement('div');
            card.className = 'match-card';
            card.innerHTML = `
                <div class="match-header">
                    <div class="match-title">${match.team1} vs ${match.team2}</div>
                    <span class="match-status ${match.is_active ? 'status-active' : 'status-inactive'}">
                        ${match.is_active ? 'АКТИВНИЙ' : 'ЗАКРИТИЙ'}
                    </span>
                </div>
                
                <form class="stats-form" id="form-${match.match_id}">
                    <div class="form-group">
                        <label>Голи ${match.team1}:</label>
                        <input type="number" name="team1_goals" value="${match.team1_goals || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Голи ${match.team2}:</label>
                        <input type="number" name="team2_goals" value="${match.team2_goals || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Володіння ${match.team1} (%):</label>
                        <input type="number" name="team1_possession" value="${match.team1_possession || 50}" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>Володіння ${match.team2} (%):</label>
                        <input type="number" name="team2_possession" value="${match.team2_possession || 50}" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>Удари ${match.team1}:</label>
                        <input type="number" name="team1_shots" value="${match.team1_shots || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Удари ${match.team2}:</label>
                        <input type="number" name="team2_shots" value="${match.team2_shots || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Удари в створ ${match.team1}:</label>
                        <input type="number" name="team1_shots_on_target" value="${match.team1_shots_on_target || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Удари в створ ${match.team2}:</label>
                        <input type="number" name="team2_shots_on_target" value="${match.team2_shots_on_target || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Кутові ${match.team1}:</label>
                        <input type="number" name="team1_corners" value="${match.team1_corners || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Кутові ${match.team2}:</label>
                        <input type="number" name="team2_corners" value="${match.team2_corners || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Фоли ${match.team1}:</label>
                        <input type="number" name="team1_fouls" value="${match.team1_fouls || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Фоли ${match.team2}:</label>
                        <input type="number" name="team2_fouls" value="${match.team2_fouls || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Жовті картки ${match.team1}:</label>
                        <input type="number" name="team1_yellow_cards" value="${match.team1_yellow_cards || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Жовті картки ${match.team2}:</label>
                        <input type="number" name="team2_yellow_cards" value="${match.team2_yellow_cards || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Червоні картки ${match.team1}:</label>
                        <input type="number" name="team1_red_cards" value="${match.team1_red_cards || 0}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Червоні картки ${match.team2}:</label>
                        <input type="number" name="team2_red_cards" value="${match.team2_red_cards || 0}" min="0">
                    </div>
                </form>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="updateStats(${match.match_id})">Оновити статистику</button>
                    ${match.is_active 
                        ? `<button class="btn btn-danger" onclick="closeMatch(${match.match_id})">Закрити матч</button>`
                        : `<button class="btn btn-success" onclick="activateMatch(${match.match_id})">Активувати матч</button>`
                    }
                </div>
            `;
            return card;
        }

        async function updateStats(matchId) {
            try {
                const form = document.getElementById(`form-${matchId}`);
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                // Convert to integers
                Object.keys(data).forEach(key => {
                    data[key] = parseInt(data[key]) || 0;
                });

                const response = await fetch(`/api/admin/match/${matchId}/update-stats`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    showAlert('Статистику успішно оновлено!', 'success');
                    await loadMatches();
                } else {
                    showAlert(result.message || 'Помилка оновлення статистики', 'error');
                }
            } catch (error) {
                console.error('Error updating stats:', error);
                showAlert('Помилка оновлення статистики', 'error');
            }
        }

        async function closeMatch(matchId) {
            if (!confirm('Ви впевнені, що хочете закрити цей матч? Голосування буде неможливим.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/match/${matchId}/close`, {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    showAlert('Матч успішно закрито!', 'success');
                    await loadMatches();
                } else {
                    showAlert(result.message || 'Помилка закриття матчу', 'error');
                }
            } catch (error) {
                console.error('Error closing match:', error);
                showAlert('Помилка закриття матчу', 'error');
            }
        }

        async function activateMatch(matchId) {
            try {
                const response = await fetch(`/api/admin/match/${matchId}/activate`, {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    showAlert('Матч успішно активовано!', 'success');
                    await loadMatches();
                } else {
                    showAlert(result.message || 'Помилка активації матчу', 'error');
                }
            } catch (error) {
                console.error('Error activating match:', error);
                showAlert('Помилка активації матчу', 'error');
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.classList.remove('hidden');
            
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 5000);
        }

        // Load matches on page load
        document.addEventListener('DOMContentLoaded', loadMatches);
    </script>
</body>
</html>
